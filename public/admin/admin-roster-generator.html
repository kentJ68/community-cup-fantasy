<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Roster Generator â€” Admin</title>
  <script src="/socket.io/socket.io.js"></script>
  <style>
    body{font-family:Arial;background:#071022;color:#eaf6ff;padding:20px}
    .card{background:#041225;padding:16px;border-radius:10px;margin-bottom:14px}
    select,input,button,textarea{padding:8px;border-radius:8px;border:1px solid #2b3a4a;background:#061426;color:#fff}
    button{background:#ffd166;color:#081018;border:0;font-weight:700;cursor:pointer}
    table{width:100%;border-collapse:collapse;margin-top:12px}
    th,td{padding:8px;border-bottom:1px solid rgba(255,255,255,0.04)}
    .small{font-size:0.9rem;color:#9fb0c0}
  </style>
</head>
<body>
  <h2>Per-Match Roster Generator</h2>

  <div class="card">
    <label class="small">Select match (to push roster)</label><br/>
    <select id="matchSelect"></select>
    <div style="height:8px"></div>
    <label class="small">Admin token (or embed into code)</label><br/>
    <input id="adminToken" placeholder="paste admin token here" style="width:60%"/>
  </div>

  <div class="card">
    <label class="small">Pick Team A & Team B</label><br/>
    <select id="teamA"></select>
    <select id="teamB"></select>
    <button id="genBtn">Generate Roster (combine)</button>
    <button id="shuffleBtn">Shuffle order</button>
    <button id="removeDuplicatesBtn">Remove duplicates</button>
  </div>

  <div class="card">
    <h3>Roster Preview (<span id="count">0</span> players)</h3>
    <div id="preview"></div>
    <div style="margin-top:10px">
      <button id="pushBtn">Push roster to selected match</button>
      <span class="small" style="margin-left:12px">This will POST to /api/admin/matches/:matchId/roster</span>
    </div>
  </div>

<script>
// --- Embedded roster data (teamCode => players[]) ---
// Use the same player lists used in mega CSV; trimmed here for readability but full lists are included.
const TEAM_ROSTERS = {
  CSK: [
    {playerName:"Ruturaj Gaikwad", role:"BAT", realTeam:"CSK", credits:9},
    {playerName:"Devon Conway", role:"BAT", realTeam:"CSK", credits:8.5},
    {playerName:"Ajinkya Rahane", role:"BAT", realTeam:"CSK", credits:8},
    {playerName:"Daryl Mitchell", role:"AR", realTeam:"CSK", credits:8.5},
    {playerName:"Ravindra Jadeja", role:"AR", realTeam:"CSK", credits:9},
    {playerName:"Moeen Ali", role:"AR", realTeam:"CSK", credits:8},
    {playerName:"Shivam Dube", role:"AR", realTeam:"CSK", credits:8.5},
    {playerName:"MS Dhoni", role:"WK", realTeam:"CSK", credits:8.5},
    {playerName:"Sameer Rizvi", role:"BAT", realTeam:"CSK", credits:7},
    {playerName:"Deepak Chahar", role:"BOWL", realTeam:"CSK", credits:8},
    {playerName:"Matheesha Pathirana", role:"BOWL", realTeam:"CSK", credits:8.5},
    {playerName:"Maheesh Theekshana", role:"BOWL", realTeam:"CSK", credits:8},
    {playerName:"Mustafizur Rahman", role:"BOWL", realTeam:"CSK", credits:7.5}
  ],
  MI: [
    {playerName:"Rohit Sharma", role:"BAT", realTeam:"MI", credits:9.5},
    {playerName:"Ishan Kishan", role:"WK", realTeam:"MI", credits:9},
    {playerName:"Suryakumar Yadav", role:"BAT", realTeam:"MI", credits:9.5},
    {playerName:"Tilak Varma", role:"BAT", realTeam:"MI", credits:8.5},
    {playerName:"Hardik Pandya", role:"AR", realTeam:"MI", credits:9},
    {playerName:"Tim David", role:"AR", realTeam:"MI", credits:8},
    {playerName:"Cameron Green", role:"AR", realTeam:"MI", credits:8.5},
    {playerName:"Jasprit Bumrah", role:"BOWL", realTeam:"MI", credits:9},
    {playerName:"Piyush Chawla", role:"BOWL", realTeam:"MI", credits:8},
    {playerName:"Jason Behrendorff", role:"BOWL", realTeam:"MI", credits:7.5},
    {playerName:"Arjun Tendulkar", role:"BOWL", realTeam:"MI", credits:7},
    {playerName:"Gerald Coetzee", role:"BOWL", realTeam:"MI", credits:8.5}
  ],
  RCB: [
    {playerName:"Faf du Plessis", role:"BAT", realTeam:"RCB", credits:9},
    {playerName:"Virat Kohli", role:"BAT", realTeam:"RCB", credits:10},
    {playerName:"Glenn Maxwell", role:"AR", realTeam:"RCB", credits:9},
    {playerName:"Rajat Patidar", role:"BAT", realTeam:"RCB", credits:8},
    {playerName:"Dinesh Karthik", role:"WK", realTeam:"RCB", credits:8},
    {playerName:"Mohammed Siraj", role:"BOWL", realTeam:"RCB", credits:8.5},
    {playerName:"Reece Topley", role:"BOWL", realTeam:"RCB", credits:8},
    {playerName:"Harshal Patel", role:"BOWL", realTeam:"RCB", credits:8},
    {playerName:"Mayank Dagar", role:"BOWL", realTeam:"RCB", credits:7.5}
  ],
  KKR: [
    {playerName:"Shreyas Iyer", role:"BAT", realTeam:"KKR", credits:9},
    {playerName:"Rinku Singh", role:"BAT", realTeam:"KKR", credits:8.5},
    {playerName:"Nitish Rana", role:"BAT", realTeam:"KKR", credits:8.5},
    {playerName:"Andre Russell", role:"AR", realTeam:"KKR", credits:9.5},
    {playerName:"Sunil Narine", role:"AR", realTeam:"KKR", credits:8.5},
    {playerName:"Venkatesh Iyer", role:"AR", realTeam:"KKR", credits:8.5},
    {playerName:"Phil Salt", role:"WK", realTeam:"KKR", credits:8.5},
    {playerName:"Mitchell Starc", role:"BOWL", realTeam:"KKR", credits:9.5},
    {playerName:"Harshit Rana", role:"BOWL", realTeam:"KKR", credits:8},
    {playerName:"Suyash Sharma", role:"BOWL", realTeam:"KKR", credits:7.5}
  ],
  DC: [
    {playerName:"David Warner", role:"BAT", realTeam:"DC", credits:9},
    {playerName:"Prithvi Shaw", role:"BAT", realTeam:"DC", credits:8.5},
    {playerName:"Rishabh Pant", role:"WK", realTeam:"DC", credits:9},
    {playerName:"Mitchell Marsh", role:"AR", realTeam:"DC", credits:8.5},
    {playerName:"Axar Patel", role:"AR", realTeam:"DC", credits:9},
    {playerName:"Jake Fraser-McGurk", role:"BAT", realTeam:"DC", credits:8.5},
    {playerName:"Kuldeep Yadav", role:"BOWL", realTeam:"DC", credits:8.5},
    {playerName:"Anrich Nortje", role:"BOWL", realTeam:"DC", credits:8.5},
    {playerName:"Ishant Sharma", role:"BOWL", realTeam:"DC", credits:7.5},
    {playerName:"Khaleel Ahmed", role:"BOWL", realTeam:"DC", credits:8}
  ],
  GT: [
    {playerName:"Shubman Gill", role:"BAT", realTeam:"GT", credits:9.5},
    {playerName:"Sai Sudharsan", role:"BAT", realTeam:"GT", credits:9},
    {playerName:"David Miller", role:"BAT", realTeam:"GT", credits:8},
    {playerName:"Wriddhiman Saha", role:"WK", realTeam:"GT", credits:8},
    {playerName:"Rahul Tewatia", role:"AR", realTeam:"GT", credits:8.5},
    {playerName:"Rashid Khan", role:"BOWL", realTeam:"GT", credits:9.5},
    {playerName:"Mohit Sharma", role:"BOWL", realTeam:"GT", credits:8.5},
    {playerName:"Noor Ahmad", role:"BOWL", realTeam:"GT", credits:8},
    {playerName:"Shivam Mavi", role:"BOWL", realTeam:"GT", credits:8}
  ],
  RR: [
    {playerName:"Sanju Samson", role:"WK", realTeam:"RR", credits:9},
    {playerName:"Yashasvi Jaiswal", role:"BAT", realTeam:"RR", credits:9.5},
    {playerName:"Jos Buttler", role:"BAT", realTeam:"RR", credits:9.5},
    {playerName:"Shimron Hetmyer", role:"BAT", realTeam:"RR", credits:8.5},
    {playerName:"Dhruv Jurel", role:"BAT", realTeam:"RR", credits:7.5},
    {playerName:"Ravichandran Ashwin", role:"AR", realTeam:"RR", credits:8.5},
    {playerName:"Riyan Parag", role:"AR", realTeam:"RR", credits:8.5},
    {playerName:"Trent Boult", role:"BOWL", realTeam:"RR", credits:9},
    {playerName:"Yuzvendra Chahal", role:"BOWL", realTeam:"RR", credits:9},
    {playerName:"Sandeep Sharma", role:"BOWL", realTeam:"RR", credits:8}
  ],
  SRH: [
    {playerName:"Abhishek Sharma", role:"BAT", realTeam:"SRH", credits:8.5},
    {playerName:"Aiden Markram", role:"BAT", realTeam:"SRH", credits:8.5},
    {playerName:"Heinrich Klaasen", role:"WK", realTeam:"SRH", credits:9.5},
    {playerName:"Rahul Tripathi", role:"BAT", realTeam:"SRH", credits:8.5},
    {playerName:"Marco Jansen", role:"AR", realTeam:"SRH", credits:8.5},
    {playerName:"Mayank Markande", role:"BOWL", realTeam:"SRH", credits:8},
    {playerName:"Bhuvneshwar Kumar", role:"BOWL", realTeam:"SRH", credits:8.5},
    {playerName:"Pat Cummins", role:"BOWL", realTeam:"SRH", credits:9},
    {playerName:"T Natarajan", role:"BOWL", realTeam:"SRH", credits:8}
  ],
  LSG: [
    {playerName:"KL Rahul", role:"WK", realTeam:"LSG", credits:9.5},
    {playerName:"Quinton de Kock", role:"WK", realTeam:"LSG", credits:9},
    {playerName:"Marcus Stoinis", role:"AR", realTeam:"LSG", credits:8.5},
    {playerName:"Nicholas Pooran", role:"WK", realTeam:"LSG", credits:9},
    {playerName:"Ayush Badoni", role:"BAT", realTeam:"LSG", credits:7.5},
    {playerName:"Krunal Pandya", role:"AR", realTeam:"LSG", credits:8},
    {playerName:"Mark Wood", role:"BOWL", realTeam:"LSG", credits:8.5},
    {playerName:"Ravi Bishnoi", role:"BOWL", realTeam:"LSG", credits:8.5},
    {playerName:"Naveen-ul-Haq", role:"BOWL", realTeam:"LSG", credits:8}
  ],
  PBKS: [
    {playerName:"Shikhar Dhawan", role:"BAT", realTeam:"PBKS", credits:9},
    {playerName:"Jonny Bairstow", role:"WK", realTeam:"PBKS", credits:9},
    {playerName:"Liam Livingstone", role:"AR", realTeam:"PBKS", credits:9},
    {playerName:"Jitesh Sharma", role:"WK", realTeam:"PBKS", credits:8.5},
    {playerName:"Sam Curran", role:"AR", realTeam:"PBKS", credits:9},
    {playerName:"Shashank Singh", role:"BAT", realTeam:"PBKS", credits:7.5},
    {playerName:"Arshdeep Singh", role:"BOWL", realTeam:"PBKS", credits:8.5},
    {playerName:"Harpreet Brar", role:"BOWL", realTeam:"PBKS", credits:8},
    {playerName:"Rahul Chahar", role:"BOWL", realTeam:"PBKS", credits:8},
    {playerName:"Kagiso Rabada", role:"BOWL", realTeam:"PBKS", credits:9}
  ]
};

// --- populate team selects ---
function populateTeams(){
  const teamKeys = Object.keys(TEAM_ROSTERS).sort();
  const ta = document.getElementById('teamA'), tb = document.getElementById('teamB');
  ta.innerHTML = '<option value="">-- team A --</option>' + teamKeys.map(k=>`<option value="${k}">${k}</option>`).join('');
  tb.innerHTML = '<option value="">-- team B --</option>' + teamKeys.map(k=>`<option value="${k}">${k}</option>`).join('');
}

// --- load matches into match select ---
async function loadMatches(){
  const sel = document.getElementById('matchSelect');
  sel.innerHTML = '<option>Loading...</option>';
  const res = await fetch('/api/matches');
  const ms = await res.json();
  sel.innerHTML = ms.map(m=>`<option value="${m._id}">${m.name} (${m._id})</option>`).join('');
}

// --- utilities ---
function dedupePlayers(arr){
  const seen = new Set(); const out = [];
  for (const p of arr){
    const key = (p.playerName||'').toUpperCase().trim();
    if (!seen.has(key)){ seen.add(key); out.push(p); }
  }
  return out;
}
function shuffle(a){ for (let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } return a; }

// --- UI logic ---
let currentRoster = [];
document.getElementById('genBtn').addEventListener('click', () => {
  const a = document.getElementById('teamA').value;
  const b = document.getElementById('teamB').value;
  if (!a || !b) return alert('Pick both teams');
  const list = [...(TEAM_ROSTERS[a] || []), ...(TEAM_ROSTERS[b] || [])];
  currentRoster = dedupePlayers(list);
  renderPreview();
});
document.getElementById('shuffleBtn').addEventListener('click', ()=>{ currentRoster = shuffle(currentRoster); renderPreview(); });
document.getElementById('removeDuplicatesBtn').addEventListener('click', ()=>{ currentRoster = dedupePlayers(currentRoster); renderPreview(); });

function renderPreview(){
  const preview = document.getElementById('preview');
  document.getElementById('count').textContent = currentRoster.length;
  if (!currentRoster.length) { preview.innerHTML = '<div class="small">No players yet</div>'; return; }
  preview.innerHTML = `<table><tr><th>Name</th><th>Role</th><th>Team</th><th>Credits</th></tr>${currentRoster.map((p,i)=>`<tr><td><input data-idx="${i}" class="name" value="${p.playerName}"/></td><td><input data-idx="${i}" class="role" value="${p.role}"/></td><td><input data-idx="${i}" class="team" value="${p.realTeam}"/></td><td><input data-idx="${i}" class="credits" value="${p.credits}"/></td></tr>`).join('')}</table>`;
  // add simple editing handlers
  preview.querySelectorAll('input').forEach(inp=>{
    inp.addEventListener('change', e=>{
      const idx = Number(e.target.getAttribute('data-idx'));
      const val = e.target.value;
      if (e.target.classList.contains('name')) currentRoster[idx].playerName = val;
      if (e.target.classList.contains('role')) currentRoster[idx].role = val;
      if (e.target.classList.contains('team')) currentRoster[idx].realTeam = val;
      if (e.target.classList.contains('credits')) currentRoster[idx].credits = Number(val || 0);
      document.getElementById('count').textContent = currentRoster.length;
    });
  });
}

document.getElementById('pushBtn').addEventListener('click', async ()=>{
  const matchId = document.getElementById('matchSelect').value;
  const token = document.getElementById('adminToken').value.trim() || 'Ok12345';
  if (!matchId) return alert('Select match first');
  if (!confirm(`Push ${currentRoster.length} players to match ${matchId}?`)) return;
  const res = await fetch(`/api/admin/matches/${matchId}/roster?adminToken=${encodeURIComponent(token)}`, {
    method:'POST', headers:{ 'Content-Type':'application/json'}, body: JSON.stringify({ players: currentRoster })
  });
  const j = await res.json();
  alert(JSON.stringify(j));
});

populateTeams();
loadMatches();
</script>
</body>
</html>
