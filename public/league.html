<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>League • Beowulf Fantasy (Season 2)</title>
  <link rel="stylesheet" href="/css/style.css" />

  <style>
    .teams-grid { display:grid; gap:12px; grid-template-columns: repeat(2, 1fr); }
    .team-card { display:flex; gap:12px; align-items:flex-start; padding:12px; border-radius:10px; }
    .team-logo { width:60px; height:60px; border-radius:10px; object-fit:cover; flex-shrink:0; }
    .team-meta { flex:1; }
    .team-name { font-weight:700; font-size:1rem; }
    .team-short { font-size:0.9rem; color:var(--muted); }
    .player-list { margin-top:10px; border-top:1px dashed rgba(255,255,255,0.06); padding-top:10px; display:none; }
    .player-item { padding:6px 0; display:flex; justify-content:space-between; border-bottom:1px solid rgba(255,255,255,0.03); }
    .player-item:last-child { border-bottom:none; }
    .group-title { font-size:1.1rem; font-weight:800; margin:18px 0 8px; }
    .stand-row { display:flex; justify-content:space-between; padding:8px; border-radius:8px; background:var(--card); margin-bottom:8px; }
    @media (max-width:900px){ .teams-grid { grid-template-columns:1fr; } }
  </style>
</head>

<body>
<div class="app">
<script src="/js/layout.js"></script>

<main class="main">
  <h2>Community Cup — Season 2</h2>
  <p class="muted">16 teams • 4 groups • Click a team to view squad details</p>

  <section class="card">

    <div class="controls" style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:14px;">
      <input id="searchBox" class="input" placeholder="Search team or player..." style="flex:1;min-width:180px;">
      <select id="roleFilter" class="input" style="width:140px;">
        <option value="">All roles</option>
        <option value="BAT">BAT</option>
        <option value="BWL">BWL</option>
        <option value="ALL">ALL</option>
        <option value="WK">WK</option>
      </select>
      <button id="refreshBtn" class="btn-ghost">Refresh</button>
    </div>

    <div style="display:flex;gap:18px;flex-wrap:wrap;">
      <div style="flex:2;min-width:280px;">
        <div id="groupsContainer"></div>
      </div>

      <aside style="flex:1;min-width:240px;">
        <div class="card">
          <h3>Overall Standings</h3>
          <div id="standings" class="muted">Loading…</div>
        </div>
      </aside>
    </div>

  </section>
</main>
</div>

<script>
const GROUPS = {
  "GROUP A": ["LONE RANGERS","WULF NATION","ORANGE ROCKS","KHALSA VIKINGS"],
  "GROUP B": ["UP WARRIORS","HARYANA BLAZERS","PINAKA STRIKERS","KESARI XI"],
  "GROUP C": ["PUNJAB DE SHER","AGRA GLADIATORS","THE WELLKNOWNS","ROYAL KNIGHTS"],
  "GROUP D": ["KOLKATA HEROES","PREET FIGHTERS","KOLKATA LEGENDS","LUNAR WULFS"]
};

let TEAMS = [];

const normalize = s => String(s||"").trim().toUpperCase();

async function apiGet(url){
  const r = await fetch(url);
  return r.json();
}

function logo(team){
  return team.logoUrl || team.logo || "/assets/logo.png";
}

function renderGroups(){
  const q = searchBox.value.toLowerCase();
  const role = roleFilter.value;
  const wrap = document.getElementById("groupsContainer");
  wrap.innerHTML = "";

  for (const [group, names] of Object.entries(GROUPS)) {
    const wanted = names.map(normalize);

    const teams = TEAMS.filter(t => wanted.includes(normalize(t.name)))
      .filter(t => {
        if (role && !(t.players||[]).some(p => p.role === role)) return false;
        if (!q) return true;
        const s = (t.name + " " + (t.players||[]).map(p=>p.playerName).join(" ")).toLowerCase();
        return s.includes(q);
      });

    wrap.innerHTML += `
      <div class="group-title">${group}</div>
      <div class="teams-grid">
        ${teams.length ? teams.map(team => `
          <div class="team-card card">
            <img class="team-logo" src="${logo(team)}" onerror="this.src='/assets/logo.png'">
            <div class="team-meta">
              <div style="display:flex;justify-content:space-between;">
                <div>
                  <div class="team-name">${team.name}</div>
                  <div class="team-short">${team.shortName||""}</div>
                </div>
                <div style="font-weight:700">${team.seasonPoints||0} pts</div>
              </div>
              <button class="btn-ghost small toggle">Show players</button>
              <div class="player-list">
                ${(team.players||[]).map(p=>`
                  <div class="player-item">
                    <span>${p.playerName}</span>
                    <span class="muted small">${p.role||""}</span>
                  </div>
                `).join("")}
              </div>
            </div>
          </div>
        `).join("") : `<div class="muted">Teams not loaded yet</div>`}
      </div>
    `;
  }

  document.querySelectorAll(".toggle").forEach(btn=>{
    btn.onclick = ()=>{
      const list = btn.nextElementSibling;
      const open = list.style.display === "block";
      list.style.display = open ? "none" : "block";
      btn.textContent = open ? "Show players" : "Hide players";
    };
  });

  renderStandings();
}

function renderStandings(){
  const box = document.getElementById("standings");
  const sorted = [...TEAMS].sort((a,b)=>(b.seasonPoints||0)-(a.seasonPoints||0));
  box.innerHTML = sorted.map((t,i)=>`
    <div class="stand-row">
      <div>${i+1}. ${t.name}</div>
      <div><strong>${t.seasonPoints||0}</strong></div>
    </div>
  `).join("");
}

async function loadTeams(){
  const j = await apiGet("/api/league/teams");
  TEAMS = j.teams || [];
  renderGroups();
}

refreshBtn.onclick = loadTeams;
searchBox.oninput = renderGroups;
roleFilter.onchange = renderGroups;

loadTeams();
</script>
</body>
</html>
