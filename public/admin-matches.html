<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin â€” Create Match â€¢ Beowulf</title>
  <style>
    :root{
      --bg:#071018; --card:#0b1620; --muted:#8fb0b9; --accent:#48b0d6; --text:#e6eef3;
      --input:#06232b;
    }
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;}
    .wrap{max-width:820px;margin:28px auto;padding:18px;}
    h1{margin:0 0 10px;font-size:22px}
    .card{background:var(--card);padding:16px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);margin-bottom:16px}
    label{display:block;font-size:13px;margin-bottom:5px;color:var(--muted)}
    input[type="text"],input[type="date"],input[type="time"],textarea,select{
      width:100%;background:var(--input);border:1px solid rgba(255,255,255,0.06);
      padding:8px;border-radius:8px;color:var(--text);box-sizing:border-box;font-size:14px;
    }
    textarea{min-height:80px;resize:vertical}
    .row{display:flex;gap:12px;flex-wrap:wrap;}
    .col{flex:1;min-width:200px;}
    button{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 14px;border-radius:8px;color:var(--text);cursor:pointer;font-size:14px}
    button.primary{background:var(--accent);border-color:transparent;color:#04141c;font-weight:600}
    .muted{color:var(--muted);font-size:13px}
    .meta{font-size:13px;color:var(--muted);margin-top:6px}
    .success{color:#8de19c}
    .error{color:#ff8080}
    .log{white-space:pre-wrap;background:#02121a;padding:10px;border-radius:8px;font-size:12px;max-height:240px;overflow:auto;border:1px solid rgba(255,255,255,0.05)}
    code{background:#021018;padding:2px 4px;border-radius:4px;font-size:12px}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Admin â€” Create Match</h1>

    <div class="card">
      <div class="row">
        <div class="col">
          <label>Admin token</label>
          <input id="adminToken" type="text" placeholder="x-admin-token (kept in memory)" />
        </div>
      </div>

      <div class="row" style="margin-top:12px;">
        <div class="col">
          <label>Match name</label>
          <input id="matchName" type="text" placeholder="India vs South Africa 1st T20" />
        </div>
      </div>

      <div class="row" style="margin-top:12px;">
        <div class="col">
          <label>Team A</label>
          <input id="teamA" type="text" placeholder="India" />
        </div>
        <div class="col">
          <label>Team B</label>
          <input id="teamB" type="text" placeholder="South Africa" />
        </div>
      </div>

      <div class="row" style="margin-top:12px;">
        <div class="col">
          <label>Match date (IST)</label>
          <input id="matchDate" type="date" />
        </div>
        <div class="col">
          <label>Match time (IST)</label>
          <input id="matchTime" type="time" step="60" />
        </div>
      </div>

      <div class="meta">
        This will be sent as <code>YYYY-MM-DDTHH:mm:00+05:30</code> to the server.<br>
        Example: <code>2025-12-10T19:30:00+05:30</code>
      </div>

      <div class="row" style="margin-top:12px;">
        <div class="col">
          <label>YouTube / Stream URL (optional)</label>
          <input id="streamUrl" type="text" placeholder="https://youtube.com/..." />
        </div>
      </div>

      <div class="row" style="margin-top:12px;">
        <div class="col">
          <label>External provider match ID (optional)</label>
          <input id="externalId" type="text" placeholder="provider match id (for scorecard API)" />
        </div>
      </div>

      <div class="meta" id="previewIso"></div>

      <div style="margin-top:14px;display:flex;gap:8px;align-items:center;">
        <button id="createMatchBtn" class="primary">Create match</button>
        <button id="clearBtn">Clear</button>
        <div id="status" class="meta"></div>
      </div>
    </div>

    <div class="card">
      <h3 style="margin:0 0 8px;">Response / Logs</h3>
      <div id="log" class="log"></div>
    </div>
  </div>

<script>
(function(){
  const adminTokenInput = document.getElementById('adminToken');
  const matchNameInput  = document.getElementById('matchName');
  const teamAInput      = document.getElementById('teamA');
  const teamBInput      = document.getElementById('teamB');
  const matchDateInput  = document.getElementById('matchDate');
  const matchTimeInput  = document.getElementById('matchTime');
  const streamUrlInput  = document.getElementById('streamUrl');
  const externalIdInput = document.getElementById('externalId');

  const previewIso      = document.getElementById('previewIso');
  const createMatchBtn  = document.getElementById('createMatchBtn');
  const clearBtn        = document.getElementById('clearBtn');
  const statusBox       = document.getElementById('status');
  const logBox          = document.getElementById('log');

  function log(...args){
    const t = new Date().toLocaleString();
    logBox.textContent = `[${t}] ` + args.map(a => (typeof a === 'string' ? a : JSON.stringify(a))).join(' ') + '\n' + logBox.textContent;
  }

  function getAdminHeaders() {
    const token = adminTokenInput.value.trim();
    const headers = { "Content-Type": "application/json" };
    if (token) headers["x-admin-token"] = token;
    return headers;
  }

  // ðŸ”¥ Build IST ISO string: YYYY-MM-DDTHH:mm:00+05:30
  function buildStartTimeIST() {
    const d = matchDateInput.value; // "2025-12-10"
    const t = matchTimeInput.value; // "19:30"
    if (!d || !t) return null;
    return `${d}T${t}:00+05:30`;
  }

  function updatePreview() {
    const iso = buildStartTimeIST();
    if (iso) {
      previewIso.innerHTML = `Will send <code>${iso}</code> as <code>startTime</code> (IST explicit).`;
    } else {
      previewIso.textContent = 'Select date & time to see the exact startTime string.';
    }
  }

  matchDateInput.addEventListener('change', updatePreview);
  matchTimeInput.addEventListener('change', updatePreview);

  createMatchBtn.addEventListener('click', async () => {
    const name = matchNameInput.value.trim();
    const teamA = teamAInput.value.trim();
    const teamB = teamBInput.value.trim();
    const streamUrl = streamUrlInput.value.trim();
    const externalId = externalIdInput.value.trim();
    const startTime = buildStartTimeIST();

    if (!name) return alert("Match name is required.");
    if (!teamA || !teamB) {
      if (!confirm("Team A or Team B is empty. Continue anyway?")) return;
    }
    if (!startTime) return alert("Select match date and time (IST).");

    const payload = { name, teamA, teamB, streamUrl, externalId, startTime };

    statusBox.textContent = "Creating match...";
    statusBox.className = "meta";
    createMatchBtn.disabled = true;

    try {
      const res = await fetch("/api/admin/matches", {
        method: "POST",
        headers: getAdminHeaders(),
        body: JSON.stringify(payload)
      });
      const j = await res.json();
      if (!j.ok) {
        statusBox.textContent = "Error: " + (j.error || JSON.stringify(j));
        statusBox.className = "meta error";
        log("create match error", j);
        alert("Error: " + (j.error || "Failed to create match"));
      } else {
        statusBox.textContent = "Match created.";
        statusBox.className = "meta success";
        log("match created", j.match || j);
        alert("Match created successfully!");
      }
    } catch (err) {
      console.error(err);
      statusBox.textContent = "Network error";
      statusBox.className = "meta error";
      log("network error", err.message || err);
      alert("Network error: " + (err.message || err));
    } finally {
      createMatchBtn.disabled = false;
    }
  });

  clearBtn.addEventListener('click', () => {
    matchNameInput.value = "";
    teamAInput.value = "";
    teamBInput.value = "";
    matchDateInput.value = "";
    matchTimeInput.value = "";
    streamUrlInput.value = "";
    externalIdInput.value = "";
    previewIso.textContent = "";
    statusBox.textContent = "";
    log("form cleared");
  });

  // Optional: prompt token once
  (function maybePromptToken(){
    if (!adminTokenInput.value.trim()) {
      const t = prompt("Enter admin token (x-admin-token) â€” stored only until refresh. Leave blank if you use JWT Authorization header instead.");
      if (t !== null) adminTokenInput.value = t;
    }
  })();
})();
</script>
</body>
</html>
